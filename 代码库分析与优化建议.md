# ToolBox 代码库分析与优化建议（Todo）

> 说明：本文件作为持续优化清单使用。已完成项使用 `[x]` 标记，待办项使用 `[ ]` 标记。

## 1. 代码库内容概览

- 该项目是一个基于 **PyQt5 + qfluentwidgets** 的桌面工具箱应用，主入口为 `ToolBox.py`，通过 `SplitFluentWindow` 组织多个子页面。当前包含：主页、PDF 处理、图片转换三个功能页。
- `First_page.py` 实现 PDF 压缩：将每页渲染为位图后量化压缩，再用 PIL 重新保存为 PDF。
- `Second_page.py` 实现图片格式转换：支持 png/jpg/jpeg/gif/bmp/ico 等输出。
- `ui/` 下是 Qt Designer 生成的界面文件和图标资源；`Ui_*.py` 为对应生成代码；`ver.py` 提供版本号文本。

## 2. 优化 Todo（按优先级）

### P0（高优先级）

- [x] **线程与 UI 更新模型规范化（PDF）**
  - 已将 PDF 压缩从 `threading.Thread` 调整为 `QThread` 工作器模型。
  - 已增加任务运行状态控制（运行中防重复启动、完成/失败后恢复按钮状态）。

- [x] **路径处理跨平台化（核心路径）**
  - 已在 PDF 与图片转换核心流程中使用 `pathlib.Path` 进行路径拼接和输出路径计算。

- [x] **输入校验补强（图片转换）**
  - 已增加“未选择输出格式”校验，避免空格式导致运行时错误。

- [ ] **输入校验补强（进一步完善）**
  - 增加输出目录可写性检查。
  - 增加同名文件覆盖策略（覆盖/跳过/重命名）。

### P1（中优先级）

- [x] **主题切换逻辑收敛**
  - 已将主题颜色设置收敛为集中函数，统一管理需改色控件列表，降低维护成本。

- [x] **业务逻辑与 UI 解耦**
  - 已提取 `services/`（`pdf_service.py`, `image_service.py`），页面层主要负责参数收集和结果展示。

- [x] **异常处理与用户反馈增强（基础版）**
  - 已补充关键流程异常捕获并反馈错误原因（如 PDF 压缩失败、图片转换失败）。

- [ ] **异常处理与用户反馈增强（统一版）**
  - 目标：统一错误提示模板（错误类型、建议操作、日志定位信息）。

### P2（中长期）

- [ ] **国际化与文案统一**
  - 目标：使用 Qt 翻译机制（`tr()` + `.ts/.qm`），避免硬编码文案。

- [ ] **工程化能力建设**
  - 目标：增加 `pytest`、`ruff/flake8`、`black/isort`、`pre-commit`，并接入 CI。

## 3. 两周落地计划（勾选式）

### 第 1 周
- [x] 路径处理统一到 `pathlib`（核心流程已落地）。
- [x] 图片转换增加“未选输出格式”校验。
- [x] PDF 任务运行时禁用按钮并防重复点击。
- [ ] 图片转换任务增加运行态控制（可选：若后续改为异步任务）。

### 第 2 周
- [x] 提取 `services` 层并补最小单元测试。
- [ ] 统一异常提示模板。
- [x] 主题切换逻辑收敛为单一函数/QSS。

## 4. 预期收益

- 运行稳定性提升（减少因参数缺失与并发导致的崩溃）。
- 跨平台兼容性提升（路径处理规范化）。
- 可维护性提升（UI 与业务解耦，后续新增工具页成本降低）。
- 可测试性提升（核心逻辑可被单测覆盖）。
